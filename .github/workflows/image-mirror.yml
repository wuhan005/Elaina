name: Image Mirror
on:
  push:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        image-name: [php, python]
    steps:
      - name: Login to Tencent Cloud Container Registry
        uses: docker/login-action@v2
        with:
          registry: ccr.ccs.tencentyun.com
          username: ${{ secrets.TENCENTCLOUD_REGISTRY_USERNAME }}
          password: ${{ secrets.TENCENTCLOUD_REGISTRY_PASSWORD }}

      - name: Push image
        run: |
          docker pull glot/${{ matrix.image-name }}:latest
          docker tag docker.io/glot/${{ matrix.image-name }}:latest ccr.ccs.tencentyun.com/qcloud-image/glot:${{ matrix.image-name }}
          docker push ccr.ccs.tencentyun.com/qcloud-image/glot:${{ env.IMAGE_TAG }}

